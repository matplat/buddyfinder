---
import "../styles/global.css";

interface Props {
  title?: string;
}

const { title = "BuddyFinder" } = Astro.props;

// Odczytaj użytkownika z middleware (zweryfikowany przez Supabase Auth)
const user = Astro.locals.user;
---

<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>
  <body>
    <nav class="border-b border-border bg-background">
      <div class="container mx-auto flex items-center justify-between px-4 py-3">
        <a href="/" class="text-xl font-bold hover:text-primary">
          BuddyFinder
        </a>
        
        <div class="flex items-center gap-4">
          {user ? (
            <>
              <a 
                href="/profile" 
                class="text-sm text-muted-foreground hover:text-foreground transition-colors"
              >
                Profil
              </a>
              <button
                type="button"
                id="logout-button"
                class="text-sm text-muted-foreground hover:text-foreground transition-colors"
              >
                Wyloguj
              </button>
            </>
          ) : (
            <>
              <a 
                href="/login" 
                class="text-sm text-muted-foreground hover:text-foreground transition-colors"
              >
                Zaloguj się
              </a>
              <a 
                href="/register" 
                class="inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors"
              >
                Zarejestruj się
              </a>
            </>
          )}
        </div>
      </div>
    </nav>
    
    <slot />

    {user && (
      <script>
        document.getElementById('logout-button')?.addEventListener('click', async () => {
          try {
            const response = await fetch('/api/auth/logout', {
              method: 'POST',
            });

            if (response.ok) {
              window.location.href = '/login';
            } else {
              console.error('Logout failed');
              alert('Wystąpił błąd podczas wylogowywania');
            }
          } catch (error) {
            console.error('Logout error:', error);
            alert('Wystąpił błąd podczas wylogowywania');
          }
        });
      </script>
    )}
  </body>
</html>
